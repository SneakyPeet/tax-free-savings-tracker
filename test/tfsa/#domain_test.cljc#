(ns tfsa.domain-tests
  (:require [tfsa.domain :as sut]
            #?(:clj [clojure.test :as t]
               :cljs [cljs.test :as t :include-macros true])
            [citrus.core :as citrus]))


(defn reconciler [state controllers]
  (citrus/reconciler {:state state
                      :controllers controllers}))


;;;; PERSON

(def person-state (atom {}))

(def person-r (reconciler person-state {:person sut/person}))

(t/deftest person-controller
  (t/testing ":init should return initial-person"
    (t/is (= {:state sut/initial-person} (sut/person :init))))
  (t/testing ":person/change should return new person"
    (t/is (= {:state "Piet"} (sut/person :person/change ["Piet"]))))
  (t/testing ":person/add should return new person"
    (t/is (= {:state "Piet"} (sut/person :person/add ["Piet"])))))


;;;; PEOPLE

(t/deftest people-controller
  (t/testing ":init should return initial-people"
    (t/is (= {:state sut/initial-people} (sut/people :init))))
  (t/testing ":person/add should add person to people"
    (t/is (= {:state (conj sut/initial-people "Piet")} (sut/people :add/person ["Piet"])))))
